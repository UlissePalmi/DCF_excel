# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a Python DCF (Discounted Cash Flow) financial model for energy companies. The primary model (`DCF_model/`) is built around **YPF** (Argentine oil company) and reads data from an Excel/CSV "Model" sheet to reconstruct all financial schedules in Python. The `old_code/` directory contains an earlier prototype targeting **Amplify Energy Corp.** that writes DCF output directly to Excel via `xlsxwriter`.

## Running the Model

```bash
# Run the demo to print all schedule outputs
python DCF_model/demo.py path/to/YPF_DCF.xlsx
# or with CSV
python DCF_model/demo.py data/model_data.csv

# The demo also auto-detects files at hardcoded paths (see demo.py:38-43)
```

No build step or test suite exists yet. Dependencies are managed via `pyproject.toml` (requires Python ≥3.12). Install `openpyxl` to use Excel input; CSV requires no extra dependencies.

## Architecture

### Data Flow
`Excel/CSV file` → `DataLoader` → `BaseSchedule subclasses` → `YPFModel`

### Key Design Pattern: Row-Mapped Schedules
All data lives in an Excel sheet named **"Model"**. `DataLoader` reads it into a `dict[(row, col)] → value` using 1-indexed coordinates. Column H=8 maps to year 2020, incrementing through column V=22 for 2034.

Each schedule class inherits from `BaseSchedule` and defines `ROW_*` class-level constants that point to specific Excel row numbers. Properties on each class call `self._series(ROW_*)` to return `{year: value}` dicts. **Adding or modifying a line item requires knowing its row number in the source Excel sheet.**

### `DCF_model/` Module Structure
- [DCF_model/data_loader.py](DCF_model/data_loader.py) — loads CSV or Excel into `(row, col)` dict; provides `get_by_year()`, `get_row_series()`, `get_historical()`, `get_projected()`
- [DCF_model/base_schedule.py](DCF_model/base_schedule.py) — base class with `_series()`, `_hist()`, `_proj()` helpers; all subclasses must implement `summary() -> dict`
- [DCF_model/schedules.py](DCF_model/schedules.py) — 14 schedule classes spanning Excel rows 1–764, in order: Oil Revenue (1–30), Crude Products Revenue (31–105), Other Products Revenue (107–167), Downstream Revenue (169–214), Total Revenue (216–277), Production Costs (279–332), S&A Expenses (334–390), Income Statement (393–437), Cash Flow Statement (441–491), Balance Sheet (494–557), Fixed Assets (560–607), Working Capital (609–680), Debt & Interest (682–729), Shareholders' Equity (732–764)
- [DCF_model/ypf_model.py](DCF_model/ypf_model.py) — orchestrator; instantiates all 14 schedules and exposes them as named attributes; `model.summary()` returns the full nested dict
- [DCF_model/demo.py](DCF_model/demo.py) — standalone script demonstrating key outputs; uses `sys.path.insert` so it can be run directly from its directory

### Import Note
Files inside `DCF_model/` use **relative imports without the package prefix** (e.g., `from data_loader import DataLoader`). When running scripts directly from that directory this works; when importing as a package via `__init__.py`, the `__init__.py` uses the correct `from .ypf_model import YPFModel` style.

### `old_code/` (legacy)
`rev_build.py` writes directly to Excel using `xlsxwriter` and `pandas`, reading from `data/AMPY_data.xlsx`. It is not integrated with the `DCF_model/` package.

## Data Files
- `data/AMPY_data.xlsx` — source data for the old Amplify Energy prototype (used by `old_code/rev_build.py`)
- `data/model_data.csv` — CSV export of the YPF Model sheet for use with `DataLoader`
- `data/pyhton Amplify Energy Corp. DCF.xlsx` — Excel output generated by `old_code/rev_build.py`
